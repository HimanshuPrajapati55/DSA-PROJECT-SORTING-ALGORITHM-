{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorting Visualizer</title>
    <link rel="stylesheet" href="{% static 'myfirst.css' %}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <header class="header">
        <nav class="navbar">
            <a href="#" class="nav-logo">DSA Visualizer Project</a>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="/" class="nav-link">Create New Array</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="merge_sort()">Merge Sort</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">Projects</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">Contact</a>
                </li>
            </ul>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </nav>
    </header>
    <div class="controls">
        <button onclick="setSpeed('low')">Low Speed</button>
        <button onclick="setSpeed('medium')">Medium Speed</button>
        <button onclick="setSpeed('high')">High Speed</button>
    </div>
    <div class = "array-boxborder">
        <div class="array-container">
            {% for i in arr %}
            <div class="array-bar-wrapper">
                <div class="array-bars" style="height:{{ i }}px; background-color: #FFA500;"></div>
                <div class="bar-value">{{ i }}</div>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <script>
        const PRIMARY_COLOR = '#00FFFF';
        const SECONDARY_COLOR = 'red';
    
        let ANIMATION_SPEED_MS = 50; // Default speed

            function setSpeed(speed) {
                switch(speed) {
                    case 'low':
                        ANIMATION_SPEED_MS = 100; // Slow speed
                        break;
                    case 'medium':
                        ANIMATION_SPEED_MS = 50; // Medium speed
                        break;
                    case 'high':
                        ANIMATION_SPEED_MS = 20; // Fast speed
                        break;
                    default:
                        ANIMATION_SPEED_MS = 50; // Default speed if something goes wrong
                        break;
                }
            }

        function merge_sort() {
            $.ajax({
                type: "POST",
                url: '{% url "mergesort" %}',
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function(animations) {
                    try {
                        const arrayBars = document.getElementsByClassName('array-bars');
                        const barValues = document.getElementsByClassName('bar-value'); // Add this line to get bar values
                        animations.forEach((animation, i) => {
                            const isColorChange = i % 3 !== 2;
                            if (isColorChange) {
                                const [barOneIdx, barTwoIdx] = animation;
                                const barOneStyle = arrayBars[barOneIdx].style;
                                const barTwoStyle = arrayBars[barTwoIdx].style;
                                const color = i % 3 === 0 ? SECONDARY_COLOR : PRIMARY_COLOR;
                                setTimeout(() => {
                                    barOneStyle.backgroundColor = color;
                                    barTwoStyle.backgroundColor = color;
                                }, i * ANIMATION_SPEED_MS);
                            } else {
                                setTimeout(() => {
                                    const [barOneIdx, newHeight] = animation;
                                    const barOneStyle = arrayBars[barOneIdx].style;
                                    barOneStyle.height = `${newHeight}px`;
                                    barValues[barOneIdx].textContent = newHeight; // Update the text content
                                }, i * ANIMATION_SPEED_MS);
                            }
                        });
                    } catch (e) {
                        console.error("Failed to parse JSON:", e);
                    }
                },
                error: function(xhr, status, error) {
                    console.error("AJAX Error:", status, error);
                }
            });
        }

        
    </script>
    
</body>
</html>
